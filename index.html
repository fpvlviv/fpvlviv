<html>
<head>
	<script>
		function genProfile(name, withEscSensor, vtxTable, pidSettings) {
			return `
defaults nosave


# version
# Betaflight / STM32F405 (S405) 4.4.3 Nov 14 2023 / 18:00:32 (738127e7e) MSP API: 1.45

# config: YES

# start the command batch
batch start

# reset configuration to default settings
defaults nosave

board_name SPEEDYBEEF405V3
manufacturer_id SPBE
mcu_id 0031002d3033470f38363131
signature 

# name: ${name}

# resources
resource MOTOR 5 NONE
resource SERVO 2 B00

# feature
feature -TELEMETRY
feature -AIRMODE
feature SERVO_TILT
${withEscSensor? 'feature ESC_SENSOR' : ''}

# serial
serial 0 2048 115200 57600 0 115200
serial 1 0 115200 57600 0 115200
serial 4 0 115200 57600 0 115200
serial 5 64 115200 57600 0 115200

# servo
servo 0 1000 2000 1500 100 8
servo 1 1000 2000 1500 100 9

# aux
aux 0 0 0 1700 2100 0 0
aux 1 1 2 1725 2100 0 0
aux 2 2 2 1300 1700 0 0
aux 3 28 3 1300 2100 0 0

# rxrange
rxrange 0 989 2012
rxrange 1 989 2012
rxrange 2 989 2012
rxrange 3 989 2012

# vtxtable
${vtxTable}

# vtx
vtx 0 1 0 0 2 1900 2100
vtx 1 1 0 0 3 1450 1600
vtx 2 1 0 0 4 950 1050

# rxfail
rxfail 3 h

${pidSettings}

# save configuration
`;
		}

		const withEscSensors = {
			crabonXing880: true,
			crabonBH900: false,
			fgBat800: false,
			fgBat900: true,
			fgEmax730: true
		};

		const vtxTables = {
			raceRanger: 'akk race ranger.txt',
			dominator: 'akk dominator.txt',
			maxsolo: 'rushfpv max solo.txt'
		};

		const pids = {
			crabonXing880: 'carbon Xing880.txt',
			crabonBH900: 'crabon BrotherHobby900.txt',
			fgBat800: 'fiberglass Bat800.txt',
			fgBat900: 'fiberglass Bat900.txt',
			fgEmax730: 'fiberglass Emax730.txt'
		};

		const names = {
			crabonXing880: 'Gurkit',
			crabonBH900: 'Gurkit',
			fgBat800: 'La Bdzhola',
			fgBat900: 'La Bdzhola',
			fgEmax730: 'La Bdzhola'
		};

		async function runGenProfile() {
			const pidOpt = document.getElementById('pid').value;
			const vtxOpt = document.getElementById('vtx').value;
			
			const pidOptName = document.getElementById('pid').options[document.getElementById('pid').selectedIndex].text;
			const vtxOptName = document.getElementById('vtx').options[document.getElementById('vtx').selectedIndex].text;
			
			const profileContents = genProfile(
				names[pidOpt], 
				withEscSensors[pidOpt], 
				await getContent('./data/vtx/' + encodeURIComponent(vtxTables[vtxOpt])),
				await getContent('./data/pid/' + encodeURIComponent(pids[pidOpt]))
			);
			
			var a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([profileContents], { type: 'text/plain' }));
            a.download = (names[pidOpt]+'_sb405v3_btf443_10frame_'+pidOptName+'_'+vtxOptName).replaceAll(',','').replaceAll(' ', '_')+'.txt';

            // Append the anchor to the body (required for Firefox)
            document.body.appendChild(a);
            // Programmatically click the anchor to trigger the download
            a.click();
            // Remove the anchor from the body
            document.body.removeChild(a);
			URL.revokeObjectURL(a.href);
		}
		
		async function getContent(url) {
	        const response = await fetch(url);
	        if (!response.ok) {
	            throw new Error(`Error: ${response.status}`);
	        }
			const x = await response.text();
	        return x;
		}
	</script>
</head>
<body>
	<div>
		Налаштування PID
		<select id="pid">
			<option value="crabonXing880">Carbon, Xing 2814 880KV</option>
			<option value="crabonBH900">Carbon, BrotherHobby AvengerV3 2812 900KV</option>
			<option value="fgBat800">Fiberglass, Bat 3110 800KV</option>
			<option value="fgBat900">Fiberglass, Bat 3115 900KV</option>
			<option value="fgEmax730">Fiberglass, Emax 2814 730KV</option>
		</select>
	</div>
	<div>
		Відеопередавач
		<select id="vtx">
			<option value="dominator">AKK Dominator</option>
			<option value="raceRanger">AKK Race Ranger</option>
			<option value="maxsolo">RushFPV Max Solo</option>
		</select>
	</div>
	<button onclick="runGenProfile()">Скачати профіль</button>
</body>
</html>
